<!DOCTYPE html>
<html>

<head>
    <title>Live Stream Viewer</title>
    <link href="https://vjs.zencdn.net/7.20.2/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }

        #video {
            width: 80%;
            max-width: 800px;
        }
    </style>
</head>

<body>
    <h1>Live Stream Viewer</h1>
    <video id="video" class="video-js vjs-default-skin" controls autoplay>
        <!-- Update the src URL to match your server's IP and port -->
    </video>
    <script>
        const video = document.getElementById('video');
        const currentUrl = new URLSearchParams(window.location.search);
        let roomId = currentUrl.get("roomId") || "default";
        fetch('/api/lives/' + roomId, { method: "GET" })
            .then((response) => response.json())
            .then((result) => {
                let { id, hostlink, viewlink, videolink } = result;

                let sourceElement = document.createElement('source');
                sourceElement.src = videolink;
                sourceElement.type = 'application/x-mpegURL';

                video.appendChild(sourceElement);
                const player = videojs('video', {
                    autoplay: true,
                    liveui: true, // Show the live UI controls in the player
                });
                player.play(); // Start playing automatically
            })
            .catch((error) => console.error(error));
    </script>
</body>

</html>
